{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}MWPUAE Platform - B2B Multi-Vendor Trading{% endblock %}</title>
    
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.gstatic.com/" crossorigin="">
    <link rel="stylesheet" as="style" onload="this.rel='stylesheet'" 
          href="https://fonts.googleapis.com/css2?display=swap&family=Work+Sans:wght@400;500;600;700;800;900&family=Noto+Sans:wght@400;500;600;700;900">
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        'sans': ['Work Sans', 'Noto Sans', 'sans-serif'],
                    },
                    colors: {
                        'primary': {
                            50: '#eff6ff',
                            500: '#0c7ff2',
                            600: '#0b72d9',
                            700: '#0a65c0',
                        }
                    }
                }
            }
        }
    </script>
    
    {% block extra_head %}{% endblock %}
</head>
<body class="bg-white" style='font-family: "Work Sans", "Noto Sans", sans-serif;'>
    <!-- Navigation -->
    <header class="flex items-center justify-between whitespace-nowrap border-b border-solid border-b-[#f0f2f5] px-4 lg:px-10 py-3 sticky top-0 z-50 bg-white/95 backdrop-blur-sm">
        <div class="flex items-center gap-4 text-[#111418]">
            {% if site_settings and site_settings.site_logo %}
                <div class="h-8">
                    <img src="{{ site_settings.site_logo }}" 
                         alt="{{ site_settings.site_name }}" 
                         class="h-8 w-auto object-contain">
                </div>
            {% else %}
                <div class="size-8">
                    <img src="{% static 'images/Metal_Wood_Plastic_Technology_FZC_LLC_icon.svg' %}" 
                         alt="MWPUAE Platform" 
                         class="w-8 h-8 object-contain">
                </div>
            {% endif %}
            <a href="{% url 'core:home' %}" class="text-[#111418] text-lg font-bold leading-tight tracking-[-0.015em]">
                {% if site_settings %}{{ site_settings.site_name }}{% else %}MWPUAE Platform{% endif %}
            </a>
        </div>
        
        <!-- Desktop Navigation -->
        <div class="hidden lg:flex flex-1 justify-center">
            <div class="flex items-center gap-9">
                <a class="text-[#111418] text-sm font-medium leading-normal hover:text-primary-500 transition-colors {% if request.resolver_match.url_name == 'home' %}text-primary-500{% endif %}" href="{% url 'core:home' %}">Home</a>
                <a class="text-[#111418] text-sm font-medium leading-normal hover:text-primary-500 transition-colors {% if request.resolver_match.url_name == 'list' %}text-primary-500{% endif %}" href="{% url 'products:list' %}">Products</a>
                <a class="text-[#111418] text-sm font-medium leading-normal hover:text-primary-500 transition-colors {% if request.resolver_match.url_name == 'about' %}text-primary-500{% endif %}" href="{% url 'core:about' %}">About</a>
                <a class="text-[#111418] text-sm font-medium leading-normal hover:text-primary-500 transition-colors {% if request.resolver_match.url_name == 'industries' %}text-primary-500{% endif %}" href="{% url 'core:industries' %}">Industries</a>
                <a class="text-[#111418] text-sm font-medium leading-normal hover:text-primary-500 transition-colors {% if request.resolver_match.url_name == 'pricing' %}text-primary-500{% endif %}" href="{% url 'core:pricing' %}">Pricing</a>
                <a class="text-[#111418] text-sm font-medium leading-normal hover:text-primary-500 transition-colors {% if request.resolver_match.url_name == 'contact' %}text-primary-500{% endif %}" href="{% url 'core:contact' %}">Contact</a>
            </div>
        </div>
        
        <!-- Auth Buttons -->
        <div class="flex items-center gap-2">
            {% if user.is_authenticated %}
                <a href="{% url 'dashboard:home' %}" class="hidden sm:flex min-w-[84px] max-w-[480px] cursor-pointer items-center justify-center overflow-hidden rounded-lg h-10 px-4 bg-primary-500 text-white text-sm font-medium leading-normal tracking-[0.015em] hover:bg-primary-600 transition-colors">
                    Dashboard
                </a>
                
                <!-- Messages Link -->
                <a href="{% url 'messaging:messages' %}" class="relative hidden sm:flex items-center justify-center rounded-lg h-10 px-4 text-[#111418] hover:bg-gray-50 transition-colors">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" fill="currentColor" viewBox="0 0 256 256">
                        <path d="M216,48H40A16,16,0,0,0,24,64V192a16,16,0,0,0,16,16H216a16,16,0,0,0,16-16V64A16,16,0,0,0,216,48ZM203.43,64,128,133.15,52.57,64ZM216,192H40V74.19l82.59,75.71a8,8,0,0,0,10.82,0L216,74.19V192Z"/>
                    </svg>
                    <span id="message-badge" class="absolute -top-1 -right-1 bg-red-500 text-white text-xs rounded-full h-4 w-4 flex items-center justify-center hidden">0</span>
                </a>
                
                <!-- User Menu -->
                <div class="relative group">
                    <button class="flex items-center gap-2 p-2 rounded-lg hover:bg-gray-50 transition-colors">
                        <div class="w-8 h-8 bg-primary-500 rounded-full flex items-center justify-center text-white text-sm font-medium">
                            {{ user.company.company_name.0|upper }}
                        </div>
                        <span class="hidden lg:block text-sm font-medium text-[#111418]">{{ user.company.company_name }}</span>
                        <svg class="w-4 h-4 text-[#60758a]" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                        </svg>
                    </button>
                    
                    <!-- Dropdown Menu -->
                    <div class="absolute right-0 mt-2 w-64 bg-white rounded-lg shadow-lg border border-gray-200 py-2 z-50 opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-200">
                        <div class="px-4 py-3 border-b border-gray-100">
                            <div class="font-semibold text-[#111418]">{{ user.company.company_name }}</div>
                            <div class="text-xs text-[#60758a]">{{ user.company.get_role_display }}</div>
                            <div class="text-xs {% if user.company.subscription_status == 'active' %}text-green-600{% elif user.company.subscription_status == 'pending' %}text-orange-600{% else %}text-red-600{% endif %}">
                                {{ user.company.get_subscription_status_display }}
                            </div>
                        </div>
                        
                        {% if user.company.subscription_status == 'active' %}
                            {% if user.company.role == 'vendor' %}
                                <a href="{% url 'products:my_products' %}" class="block px-4 py-2 text-sm text-[#111418] hover:bg-gray-50">My Products</a>
                            {% elif user.company.role == 'business_buyer' %}
                                <a href="{% url 'messaging:quotes_sent' %}" class="block px-4 py-2 text-sm text-[#111418] hover:bg-gray-50">My Quotes</a>
                            {% endif %}
                        {% endif %}
                        
                        <a href="{% url 'messaging:notifications' %}" class="block px-4 py-2 text-sm text-[#111418] hover:bg-gray-50">Notifications</a>
                        <a href="{% url 'accounts:profile' %}" class="block px-4 py-2 text-sm text-[#111418] hover:bg-gray-50">Profile Settings</a>
                        
                        {% if user.is_staff %}
                            <a href="{% url 'dashboard:admin' %}" class="block px-4 py-2 text-sm text-[#111418] hover:bg-gray-50">Admin Panel</a>
                        {% endif %}
                        
                        <hr class="my-2">
                        <a href="{% url 'accounts:logout' %}" class="block px-4 py-2 text-sm text-red-600 hover:bg-red-50">Logout</a>
                    </div>
                </div>
            {% else %}
                <a href="{% url 'accounts:login' %}" class="flex min-w-[84px] max-w-[480px] cursor-pointer items-center justify-center overflow-hidden rounded-lg h-10 px-4 text-[#111418] text-sm font-medium leading-normal hover:bg-gray-50 transition-colors">
                    Login
                </a>
                <a href="{% url 'accounts:register' %}" class="flex min-w-[84px] max-w-[480px] cursor-pointer items-center justify-center overflow-hidden rounded-lg h-10 px-4 bg-primary-500 text-white text-sm font-medium leading-normal tracking-[0.015em] hover:bg-primary-600 transition-colors">
                    Register
                </a>
            {% endif %}
            
            <!-- Mobile menu button -->
            <button id="mobile-menu-button" class="lg:hidden p-2 rounded-lg hover:bg-gray-50">
                <svg class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"/>
                </svg>
            </button>
        </div>
    </header>
    
    <!-- Mobile Navigation -->
    <div id="mobile-menu" class="lg:hidden hidden bg-white border-b border-gray-200">
        <div class="px-4 pt-2 pb-3 space-y-1">
            <a href="{% url 'core:home' %}" class="block px-3 py-2 text-[#111418] hover:bg-gray-50 rounded-lg">Home</a>
            <a href="{% url 'products:list' %}" class="block px-3 py-2 text-[#111418] hover:bg-gray-50 rounded-lg">Products</a>
            <a href="{% url 'core:about' %}" class="block px-3 py-2 text-[#111418] hover:bg-gray-50 rounded-lg">About</a>
            <a href="{% url 'core:industries' %}" class="block px-3 py-2 text-[#111418] hover:bg-gray-50 rounded-lg">Industries</a>
            <a href="{% url 'core:pricing' %}" class="block px-3 py-2 text-[#111418] hover:bg-gray-50 rounded-lg">Pricing</a>
            <a href="{% url 'core:contact' %}" class="block px-3 py-2 text-[#111418] hover:bg-gray-50 rounded-lg">Contact</a>
        </div>
    </div>


    <!-- Main Content -->
    <main>
        <!-- Messages -->
        {% if messages %}
            <div class="max-w-7xl mx-auto px-4 py-4">
                {% for message in messages %}
                    <div class="mb-4 p-4 rounded-lg {% if message.tags == 'success' %}bg-green-50 text-green-800 border border-green-200{% elif message.tags == 'error' %}bg-red-50 text-red-800 border border-red-200{% else %}bg-blue-50 text-blue-800 border border-blue-200{% endif %}">
                        {{ message }}
                    </div>
                {% endfor %}
            </div>
        {% endif %}
        
        {% block content %}
        {% endblock %}
    </main>
    
    <!-- Footer -->
    <footer class="bg-white border-t border-gray-200">
        <div class="max-w-7xl mx-auto px-4 lg:px-10">
            <!-- Main Footer Content -->
            <div class="py-12 grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-8">
                <div class="lg:col-span-1">
                    <div class="flex items-center gap-3 mb-4">
                        <div class="size-6">
                            <svg viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path d="M24 45.8096C19.6865 45.8096 15.4698 44.5305 11.8832 42.134C8.29667 39.7376 5.50128 36.3314 3.85056 32.3462C2.19985 28.361 1.76794 23.9758 2.60947 19.7452C3.451 15.5145 5.52816 11.6284 8.57829 8.5783C11.6284 5.52817 15.5145 3.45101 19.7452 2.60948C23.9758 1.76795 28.361 2.19986 32.3462 3.85057C36.3314 5.50129 39.7376 8.29668 42.134 11.8833C44.5305 15.4698 45.8096 19.6865 45.8096 24L24 24L24 45.8096Z" fill="currentColor"/>
                            </svg>
                        </div>
                        <span class="text-[#111418] text-lg font-bold">
                            {% if site_settings %}{{ site_settings.site_name }}{% else %}MWPUAE Platform{% endif %}
                        </span>
                    </div>
                    <p class="text-[#60758a] text-sm leading-relaxed mb-4">
                        Connecting businesses across Metal, Wood, Plastic, Machineries, and Technology industries with verified suppliers and secure trading solutions.
                    </p>
                    <div class="flex gap-3">
                        <a href="#" class="text-[#60758a] hover:text-primary-500 transition-colors">
                            <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" fill="currentColor" viewBox="0 0 256 256">
                                <path d="M247.39,68.94A8,8,0,0,0,240,64H209.57A48.66,48.66,0,0,0,168.1,40a46.91,46.91,0,0,0-33.75,13.7A47.9,47.9,0,0,0,120,88v6.09C79.74,83.47,46.81,50.72,46.46,50.37a8,8,0,0,0-13.65,4.92c-4.31,47.79,9.57,79.77,22,98.18a110.93,110.93,0,0,0,21.88,24.2c-15.23,17.53-39.21,26.74-39.47,26.84a8,8,0,0,0-3.85,11.93c.75,1.12,3.75,5.05,11.08,8.72C53.51,229.7,65.48,232,80,232c70.67,0,129.72-54.42,135.75-124.44l29.91-29.9A8,8,0,0,0,247.39,68.94Zm-45,29.41a8,8,0,0,0-2.32,5.14C196,166.58,143.28,216,80,216c-10.56,0-18-1.4-23.22-3.08,11.51-6.25,27.56-17,37.88-32.48A8,8,0,0,0,92,169.08c-.47-.27-43.91-26.34-44-96,16,13,45.25,33.17,78.67,38.79A8,8,0,0,0,136,104V88a32,32,0,0,1,9.6-22.92A30.94,30.94,0,0,1,167.9,56c12.66.16,24.49,7.88,29.44,19.21A8,8,0,0,0,204.67,80h16Z"/>
                            </svg>
                        </a>
                        <a href="#" class="text-[#60758a] hover:text-primary-500 transition-colors">
                            <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" fill="currentColor" viewBox="0 0 256 256">
                                <path d="M216,24H40A16,16,0,0,0,24,40V216a16,16,0,0,0,16,16H216a16,16,0,0,0,16-16V40A16,16,0,0,0,216,24Zm0,192H40V40H216V216ZM96,112v64a8,8,0,0,1-16,0V112a8,8,0,0,1,16,0Zm88,28v36a8,8,0,0,1-16,0V140a20,20,0,0,0-40,0v36a8,8,0,0,1-16,0V112a8,8,0,0,1,15.79-1.78A36,36,0,0,1,184,140ZM100,84A12,12,0,1,1,88,72,12,12,0,0,1,100,84Z"/>
                            </svg>
                        </a>
                    </div>
                </div>
                
                <div>
                    <h3 class="text-[#111418] font-semibold mb-4">Quick Links</h3>
                    <ul class="space-y-3">
                        <li><a href="{% url 'products:list' %}" class="text-[#60758a] hover:text-[#111418] transition-colors text-sm">Products</a></li>
                        <li><a href="{% url 'core:about' %}" class="text-[#60758a] hover:text-[#111418] transition-colors text-sm">About Us</a></li>
                        <li><a href="{% url 'core:industries' %}" class="text-[#60758a] hover:text-[#111418] transition-colors text-sm">Industries</a></li>
                        <li><a href="{% url 'core:pricing' %}" class="text-[#60758a] hover:text-[#111418] transition-colors text-sm">Pricing</a></li>
                    </ul>
                </div>
                
                <div>
                    <h3 class="text-[#111418] font-semibold mb-4">Support</h3>
                    <ul class="space-y-3">
                        <li><a href="{% url 'core:contact' %}" class="text-[#60758a] hover:text-[#111418] transition-colors text-sm">Contact Us</a></li>
                        <li><a href="#" class="text-[#60758a] hover:text-[#111418] transition-colors text-sm">Help Center</a></li>
                        <li><a href="#" class="text-[#60758a] hover:text-[#111418] transition-colors text-sm">Privacy Policy</a></li>
                        <li><a href="#" class="text-[#60758a] hover:text-[#111418] transition-colors text-sm">Terms of Service</a></li>
                    </ul>
                </div>
                
                <div>
                    <h3 class="text-[#111418] font-semibold mb-4">Contact Info</h3>
                    <div class="space-y-3 text-sm text-[#60758a]">
                        <p>{% if site_settings.contact_email %}{{ site_settings.contact_email }}{% else %}info@mwpuaeplatform.com{% endif %}</p>
                        <p>{% if site_settings.contact_phone %}{{ site_settings.contact_phone }}{% else %}+1 (555) 123-4567{% endif %}</p>
                        {% if site_settings.address %}
                            <p>{{ site_settings.address|linebreaks }}</p>
                        {% else %}
                            <p>123 Business Ave<br>Suite 456<br>Tech City, CA 91234</p>
                        {% endif %}
                    </div>
                </div>
            </div>
            
            <!-- Bottom Footer -->
            <div class="border-t border-gray-200 py-6">
                <div class="flex flex-col md:flex-row items-center justify-between gap-4">
                    <p class="text-[#60758a] text-sm">
                        © 2025 {% if site_settings %}{{ site_settings.site_name }}{% else %}MWPUAE Platform{% endif %}. All rights reserved.
                    </p>
                    
                    <!-- Powered by DelQ Solutions -->
                    <a href="https://delqsolutions.com" target="_blank" class="flex items-center gap-2 text-[#60758a] hover:text-[#111418] transition-colors group">
                        <span class="text-sm">Powered by</span>
                        <img src="https://delqsolutions.com/wp-content/uploads/2025/01/cropped-DELQ-Logo-scaled-1.webp" 
                             alt="DelQ Solutions" 
                             class="h-6 w-auto opacity-70 group-hover:opacity-100 transition-opacity">
                        <span class="text-sm font-medium">DelQ Solutions</span>
                    </a>
                </div>
            </div>
        </div>
    </footer>

    <!-- Scripts -->
    <script>
        // Mobile menu toggle
        document.getElementById('mobile-menu-button').addEventListener('click', function() {
            const mobileMenu = document.getElementById('mobile-menu');
            mobileMenu.classList.toggle('hidden');
        });


        {% if user.is_authenticated %}
        // Update unread message count
        function updateMessageBadge() {
            fetch('{% url "messaging:unread_count" %}')
                .then(response => response.json())
                .then(data => {
                    const badge = document.getElementById('message-badge');
                    if (data.total > 0) {
                        badge.textContent = data.total;
                        badge.classList.remove('hidden');
                    } else {
                        badge.classList.add('hidden');
                    }
                })
                .catch(error => console.log('Error fetching unread count:', error));
        }


        // Update badge on page load and every 30 seconds
        updateMessageBadge();
        setInterval(updateMessageBadge, 30000);
        {% endif %}
    </script>
    
    {% block extra_js %}{% endblock %}
</body>
</html>
